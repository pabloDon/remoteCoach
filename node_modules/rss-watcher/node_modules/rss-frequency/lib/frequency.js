
/*
 *
 * node-rss-frequency
 * Frequency.coffee
 * Author:@nikezono
 * RSSフィードの更新頻度を算出する
 *
 */

(function() {
  var parser, _;

  parser = require('parse-rss');

  _ = require('underscore');

  module.exports = function(feed, callback) {
    return parser(feed, function(error, articles) {
      var avr, date, dates, diff, i, _i, _len;
      if (error) {
        return callback(error, null);
      }
      avr = 0;
      dates = _.pluck(articles, 'pubDate');
      for (i = _i = 0, _len = dates.length; _i < _len; i = ++_i) {
        date = dates[i];
        if (dates.length === i + 1) {
          break;
        }
        diff = dates[i] / 1000 - dates[i + 1] / 1000;
        avr = avr + diff;
      }
      avr = avr / dates.length;
      return callback(null, avr);
    });
  };

}).call(this);
